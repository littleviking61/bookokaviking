function restartVideo(){this.seek(0).pause(),widget.setVolume(.3),$(".video-control").removeClass("active")}function checkCookie(){hashtag=window.location.hash,void 0===historyPage||"bienvenue"===historyPage||""!==hashtag&&"#"!==hashtag||($.fn.fullpage.setAllowScrolling(!1),$.fn.fullpage.setKeyboardScrolling(!1),swal({title:"Voulez-vous accéder directement à la dernière page visionnée ?",type:"info",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Oui, merci !",cancelButtonText:"Non",closeOnConfirm:!0},function(){window.location.hash=historyPage}))}function initCancelContainerButton(a){$(".icon-cancel",a).unbind("click").click(function(){var a=$(this).closest(".container");a.hasClass("closed")?this.closeBtn.reverse():(this.closeBtn=new TimelineLite,this.closeBtn.to(a,.3,{height:"70px",overflow:"hidden",ease:"Cubic.easeInOut"}).to($("header",a),.2,{marginTop:"70px"},"-=.2").to(a,.2,{width:"70px"},"-=.1").to(a,.1,{borderRadius:"50%"},"-=.15").eventCallback("onReverseComplete",function(){a[0].style.removeProperty("width"),a[0].style.removeProperty("height")})),a.toggleClass("closed")})}function initMenu(){nav[0].tl=new TimelineLite,nav[0].tl2=new TimelineLite,nav[0].tl.pause().to(chap,.1,{opacity:1,display:"block"}).staggerFrom($("li",chap),.09,{marginRight:"10px",opacity:0},.03),$('[href^="#menu"]',nav).mouseenter(function(){nav[0].tl2.totalDuration(.2).reverse(),nav[0].tl.totalDuration(.6).play()}).click(function(a){$(this).hasClass("active")?(keepChapitre=!1,nav[0].tl.totalDuration(.4).reverse()):(keepChapitre=!0,nav[0].tl.totalDuration(.6).play()),$(this).toggleClass("active"),a.preventDefault()}),$('[href^="#son"]',nav).mouseenter(function(){nav[0].tl.totalDuration(.2).reverse(),nav[0].tl2.totalDuration(.6).play()}).click(function(a){$(this).hasClass("active")?widget.pause():widget.play(),$(this).toggleClass("active"),a.preventDefault()}),header.mouseleave(function(){keepChapitre?(nav[0].tl2.totalDuration(.2).reverse(),nav[0].tl.totalDuration(.6).play()):($('a[href^="#menu"].active',nav).removeClass("active"),nav[0].tl.reverse(),nav[0].tl2.reverse())}),carte=$('<div class="map loading"></div>').insertAfter(header),$('[href^="#map"]',nav).mouseenter(function(){nav[0].tl.totalDuration(.2).reverse(),nav[0].tl2.totalDuration(.2).reverse()}),$('[href^="#love"]',nav).mouseenter(function(){nav[0].tl.totalDuration(.2).reverse(),nav[0].tl2.totalDuration(.2).reverse()}).click(function(a){}),$('[href^="#close"]',nav).click(function(a){a.preventDefault(),window.history.back()})}function initSoundCloudPlayer(){var a=document.getElementById("soundcloud-player-iframe");widget=SC.Widget(a),widget.bind(SC.Widget.Events.READY,function(){$('[href^="#son"]',nav).removeClass("loading"),widget.bind(SC.Widget.Events.PLAY,function(){widget.getCurrentSoundIndex(function(a){active=a,$(".list-sounds a[data-key]",soundcloudPlayer).removeClass("active"),$('.list-sounds a[data-key="'+a+'"]',soundcloudPlayer).addClass("active"),$("#play").addClass("active"),$("#pause, #stop").removeClass("active")})}),widget.bind(SC.Widget.Events.PAUSE,function(){$("#play").removeClass("active"),$("#pause").addClass("active")}),widget.bind(SC.Widget.Events.FINISH,function(){$("#play, #pause").removeClass("active")}),$("#next").click(function(a){widget.next().seekTo(0),a.preventDefault()}),$("#prev").click(function(a){widget.prev().seekTo(0),a.preventDefault()}),$("#auto").click(function(a){autoMusique=!autoMusique,$(this).toggleClass("active"),a.preventDefault()}),$("#play").click(function(a){widget.play(),$('[href^="#son"]',nav).addClass("active"),a.preventDefault()}),$("#pause").click(function(a){widget.pause(),$('[href^="#son"]',nav).removeClass("active"),a.preventDefault()}),addAllSound(widget),widget.setVolume(.3),autoplay&&$("#play").trigger("click")})}function addAllSound(a){a.getSounds(function(b){var c=[];$.each(b,function(a,b){return a>15?!1:void c.push('<li><a href="#'+b.title+'" data-key="'+a+'" data-id="'+b.id+'">'+b.title+"</a></li>")}),$(".list-sounds",soundcloudPlayer).html(c),nav[0].tl2.pause().to(soundcloudPlayer,.1,{opacity:1,display:"block"}).staggerFrom($("li",soundcloudPlayer),.09,{marginRight:"10px",opacity:0},.03),$(".list-sounds a",soundcloudPlayer).click(function(b){a.seekTo(0).skip($(this).attr("data-key")),b.preventDefault()})})}function getActiveBgVideo(){return $('[data-video-anchor="'+loadedAnchorLink+'"].active-video video',bg)}function loadBackground(a,b){var c=void 0!==b&&""!==b?'id="bg-'+b+'"':"";a=racineImg+a,$(".bg").append("<img "+c+' class="hidden" src="'+a+'"/>')}function changeBackground(a,b,c){-1===a.indexOf(racineImg)&&(a=racineImg+a),void 0!==b&&loadBackground(b,c),$(".active",bg).css("background-image")!=="url("+a+")"&&($(":not(.active)",bg).css("background-image","url("+a+")"),$(".image",bg).toggleClass("active"),void 0!==c&&$('[data-anchor="'+c+'"]').attr("data-background",a))}function addBgVideo(a,b){return 0===$('[data-video-anchor="'+b+'"]',bg).length?(newVideo=$('<div class="video" data-video-anchor="'+b+'"></div>').appendTo(bg),void 0===newVideo.data("vide")&&newVideo.vide({mp4:a},{posterType:"none",muted:!1,loop:!1,autoplay:!1}),newVideo):void 0}var racine=window.location.origin+"/",racineImg=racine+"media/img/",historyPage=Cookies.get("activePage"),autoplay=!0,autoMusique=!0,musiqueActive=0,lastBackground="",lastPlay="",keepChapitre=!1,mapActive=!1,sections,bg,page,header,nav,chap,loadedSection,loadedAnchorLink,widgetIframe,widget,playlist,active,carte,loader,arrowDown,arrowUp;$(document).ready(function(){bg=$(".bg"),page=$("main > .sections"),header=$("header.main"),nav=$("nav.main",header),chap=$(".chapitres",header),soundcloudPlayer=$(".player-soundcloud",header),arrowDown=$("main > .arrow.loading"),arrowUp=$(".arrow.unactive",header),sections=$(">.section",page),sections.each(function(){$this=$(this);var a=$this.data("background"),b=$this.data("play"),c=$this.data("anchor");(void 0===a||""===a)&&(a=lastBackground,$this.attr("data-background",a)),(void 0===b||""===b)&&(b=lastPlay,$this.attr("data-play",b)),a!==lastBackground&&loadBackground(a,c),lastBackground=a,lastPlay=b}),page.fullpage({verticalCentered:!1,scrollOverflow:!0,css3:!0,onLeave:function(a,b,c){var d=$(this),e=$(">.section:nth-child("+b+")",page),f=e.attr("data-background"),g=parseInt(e.data("play"),10);d.hasClass("banner")?(arrowDown.removeClass("active"),arrowUp.removeClass("unactive")):e.hasClass("banner")&&(arrowDown.addClass("active"),arrowUp.addClass("unactive")),void 0!==f&&""!==f&&changeBackground(f),$('[data-video-anchor="'+$(loadedSection).data("anchor")+'"]',bg).addClass("hidden"),!isNaN(g)&&autoMusique&&$('[href^="#son"]',nav).hasClass("active")&&widget.getCurrentSoundIndex(function(a){g!==a&&g!==musiqueActive&&(musiqueActive=g,widget.seekTo(0).skip(g))}),$(".video-control",d).hasClass("active")&&$(".video-control",d).trigger("click")},afterLoad:function(a,b){Cookies.set("activePage",a),analytics&&"bienvenue"!==a&&ga("send",{hitType:"pageview",page:window.location.pathname+window.location.hash}),loadedSection=$(this),loadedAnchorLink=a,anchorLinkOk="f_"+a.replace(/-/g,"_"),"function"==typeof window[anchorLinkOk]&&window[anchorLinkOk]($(this),a),$('[data-video-anchor="'+a+'"]',bg).removeClass("hidden"),initCancelContainerButton(loadedSection)}}),$("[data-fp-action]").click(function(a){if(!$(this).hasClass("loading")){var b=$(this).data("fp-action");"function"==typeof page.fullpage[b]&&page.fullpage[b](),a.preventDefault()}}),$("audio").audioPlayer(),initMenu(),initSoundCloudPlayer(),checkCookie()}),$(window).load(function(){arrowDown.removeClass("loading")}),$(window).keypress(function(a){(0===a.keyCode||32===a.keyCode)&&$(".audioplayer",loadedSection).trigger("click")}),$(window).on("hashchange",function(){if("#map"==window.location.hash||mapActive){if(analytics&&ga("send",{hitType:"pageview",page:"/#map"}),mapActive)carte.removeClass("active"),header.removeClass("closed"),$.fn.fullpage.setAllowScrolling(!0),$.fn.fullpage.setKeyboardScrolling(!0);else if(carte.hasClass("loading")){var a=$('[href^="#map"]',nav);a.addClass("loading"),$.ajax({url:"/pages/map.php",context:carte}).done(function(b){a.removeClass("loading"),carte.html(b).addClass("active").removeClass("loading"),header.addClass("closed"),$.fn.fullpage.setAllowScrolling(!1),$.fn.fullpage.setKeyboardScrolling(!1)})}else carte.addClass("active"),header.addClass("closed"),$.fn.fullpage.setAllowScrolling(!1),$.fn.fullpage.setKeyboardScrolling(!1);$('[href^="#map"]',nav).toggleClass("active"),mapActive=!mapActive}}),$(".video-control").click(function(){$(this).hasClass("active")?($(".active-video",bg).length>0&&$(".active-video",bg).data("vide").getVideoObject().pause(),this.tl.pause(),this.paused=!0,widget.setVolume(.3)):(this.paused&&$(".active-video",bg).length>0&&$(".active-video",bg).data("vide").getVideoObject().play(),this.tl.play(),widget.setVolume(.1)),$(this).toggleClass("active")});